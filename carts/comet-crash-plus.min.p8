pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
p=0 bb=false l=true b=false m=0 cw={x=0,y=0} cp={ x=0, y=0, vx=0, vy=0 } bc={ {13,12,7}, {8,9,10}, {5,6,7}, {9,10} } function q(i) return bc[i][flr(rnd(#bc[i]))+1],bc[i][#bc[i]] end function s(x,y) cw.x=x cw.y=y camera(x+cp.x,y+cp.y) end function bd(amt) ds=1 if rnd()>.5 then ds=-1 end dt=1 if rnd()>.5 then dt=-1 end cp.x+=ds*amt cp.y+=dt*amt end function cq(num,x,y,vx,vy,cols,life,kind) if num==-1 and bb then return end if num==-1 then num=1 end for i=1,num do k=cols[flr(rnd(#cols)+1)] ce=1 if rnd()>.5 then ce=-1 end cf=1 if rnd()>.5 then cf=-1 end add(d,{ x=x, y=y, vx=vx*rnd()*ce, vy=vy*rnd()*cf, col=k, cur=0, life=life, size=rnd(2), kind=kind }) end end function be(chars,x,y,col) local cg=0 local ch=0 local cz=col for i=1,#chars do local cs=sub(chars,i,i) if cs == '|' then ch=0 cg+=1 cz=col elseif cs == '!' then cz=7 elseif cs == '@' then cz=8 elseif cs == '#' then cz=14 else print(cs,x+(ch*4),y+(cg*7)+sin(-time()/2+(ch*2/#chars))*2,cz) ch+=1 end if cs == ' ' then cz=col end end end e=1 function a() t={2,3,4,5,6,8,10,11,12,13} for i=1,#t do pal(t[i],12) end bf=t[e] pal(bf,7) sspr(0,0,128,32,0,37) e+=1 if e > #t then e = 1 end for i=1,#t do pal(t[i],t[i]) end end function ca(dx,dy,r) if f then return end dx=abs(dx) dy=abs(dy) if dx>r or dy>r then return end dist=sqrt(dx*dx+dy*dy) return dist<=r end function cb() n=0 bg=0 bh=0 g=0 f=false c=0 d={} u={ x=0, y=0, s=0, vx=0, vy=0 } bl={} ct={x=-99,y=0} v={} for i=1,128 do add(bl,{ x=rnd(128), y=rnd(128), z=flr(i/42)+1 }) end if not l then o() end end function o() ct={ x=u.x+rnd(512)-256, y=u.y+rnd(512)-256 } end function cu() n+=1 u.s=0 w=45 v={} for i=1,n+1 do add(v,{ x=u.x+rnd(512)-256, y=u.y+rnd(512)-256, vx=0, vy=0 }) end add(v,u) end function _init() cb() f=true c=100 end function _draw() pal(0, 129, 1) pal(13, 140, 1) pal(5, 13, 1) pal(14, 143, 1) cls(0) p+=1 if p==2 then if bb then bb=false else bb=true end p=0 end cp.vx+=-cp.x*.4 cp.vy+=-cp.y*.4 cp.vx*=.85 cp.vy*=.85 cp.x+=cp.vx cp.y+=cp.vy if cp.vx>-.1 and cp.vx<.1 and cp.vy>-.1 and cp.vy<.1 then cp.vx=0 cp.vy=0 end for i,cv in pairs(bl) do cv.x-=u.vx/cv.z/2 cv.y-=u.vy/cv.z/2 ds=cv.x dt=cv.y if cv.x<0 then cv.x=127 end if cv.x>127 then cv.x=0 end if cv.y<0 then cv.y=127 end if cv.y>127 then cv.y=0 end srand(i) t={5,13,1} s(0,0) circ(ds,dt,0,t[cv.z]) end srand(time()) ds=.05 if f or l then if c>45 then if btnp(4) or btnp(5) then if b or not l then l=false b=false cb() cu() sfx(2) elseif l then b=true sfx(2) end end end else if btn(0) then u.vx-=ds end if btn(1) then u.vx+=ds end if btn(2) then u.vy-=ds end if btn(3) then u.vy+=ds end if btn(0) or btn(1) or btn(2) or btn(3) then sfx(5) bf=bc[1] if u.s>0 then bf=bc[2] end cq(1,u.x,u.y,u.vx/2,u.vy/2,bf,10) end if u.s>0 and g<1 then if btnp(4) or btnp(5) then bd(3) cq(100,u.x,u.y,7,7,bc[2],50) sfx(0) g=45 w=0 u.s=0 du=atan2(u.vx,u.vy) ds=cos(du)*5 dt=sin(du)*5 if btnp(5) then ds*=-1 dt*=-1 u.vx*=-1 u.vy*=-1 end u.vx+=ds u.vy+=dt end end end s(u.x-64,u.y-64) circ(ct.x,ct.y,6+rnd(18),13+rnd(3)) cq(-1,ct.x,ct.y,.7,.7,{1,2,13,14},50) if bb then circfill(ct.x,ct.y,21+rnd(6),rnd(3)) end cl=u.x-ct.x cm=u.y-ct.y if ca(cl,cm,23) then if u.s<1 then o() bd(2) cq(50,ct.x,ct.y,3,3,{12,15,13,14},30) cq(50,u.x,u.y,3,3,{12,15,13,14},30) u.s=1 w=0 sfx(1) end end for k,h in pairs(d) do h.vx*=.99 h.vy*=.99 h.x+=h.vx h.y+=h.vy h.cur+=1 if h.cur>h.life then del(d,h) end circ(h.x,h.y,h.size,h.col) end for i,bm in pairs(v) do cn=1 if u.s>0 and g<1 then cn=2 end if g>0 then cn=2 end bf,z=q(cn) if w>0 and bb and g<1 then bf=0 end if bm~=u then bf,z=q(3) cc=12 if not f then cl=u.x-bm.x cm=u.y-bm.y bm.vx+=cl*.001 bm.vy+=cm*.001 end du=0 if u.s>0 then du=2 end if g>0 then du=21 end if ca(cl,cm,7+du) then if (w<1 and u.s>0) or g>0 then del(v,bm) bd(3) cq(50,u.x,u.y,3,3,bc[2],30) sfx(3) if g<1 then w=60 bg+=10 u.s=0 else bg+=30 end elseif (not f) and w<1 then f=true c=0 bd(7) sfx(3) cq(90,u.x,u.y,3,3,bc[1],200) cq(10,bm.x,bm.y,3,3,bc[3],200) end end du=1 else if w>0 then w-=1 end du=1+(u.s/4) end bm.vx*=.99 bm.vy*=.99 bm.x+=bm.vx bm.y+=bm.vy if bm~=u then for j,co in pairs(v) do if co~=bm and co~=u then cl=co.x-bm.x cm=co.y-bm.y if ca(cl,cm,15) then bm.vx-=cl*.02 bm.vy-=cm*.02 end end end end if bm==u and g>0 then if p%2==0 then circfill(bm.x,bm.y,16+rnd(6),8+rnd(3)) circ(bm.x,bm.y,6+rnd(18),8+rnd(3)) end g-=1 end if (bm==u and not f) or bm~=u then circfill(bm.x,bm.y,du+1+rnd(2),bf) if abs(bm.vx)>3.5 or abs(bm.vy)>3.5 then end if bm==u and u.s>0 then end for i=1,12 do cd=i/(12) ds=bm.x-bm.vx*3*cd+(rnd(2)-1) dt=bm.y-bm.vy*3*cd+(rnd(2)-1) cd=du-cd circfill(ds,dt,cd*3,bf) end circfill(bm.x,bm.y,du+rnd(2),z) end end if #v==1 then cu() end s(0,0) ba=0 if not f then for i,bm in pairs(v) do if i<#v then cl=u.x-bm.x cm=u.y-bm.y if abs(cl)>64 or abs(cm)>64 then bf=8 if abs(cl)<96 and abs(cm)<96 then if bb then bf=10 end ba+=1 end du=atan2(cl,cm) ds=-cos(du)*50 dt=-sin(du)*50 cl=-cos(du)*60 cm=-sin(du)*60 line(ds+64,dt+64,cl+64,cm+64,bf) end end end cl=u.x-ct.x cm=u.y-ct.y if abs(cl)>64 or abs(cm)>64 then bf=14 if abs(cl)<96 and abs(cm)<96 and bb then bf=7 end du=atan2(cl,cm) ds=-cos(du)*50 dt=-sin(du)*50 cl=-cos(du)*60 cm=-sin(du)*60 line(ds+64,dt+64,cl+64,cm+64,bf) end end if m==0 and ba>0 then sfx(4) end m+=1 m=m%4 if not l then print('wave  '..n,3,3,12) print('score '..bg,3,10,12) end if l and not b then u.vx = -7.5 u.vy = 5 end if c<100 then c+=1 end if f and c>45 and not l then if bb then print('press z/x',44,61,7) end end if l and not b then ds=rnd(80)-40 dt=rnd(20)-10 cq(1,ds,dt,1,2,bc[4],10) ds=41 dt=46 du=7 bf=12+rnd(2) z=7 circfill(ds,dt,du+1+rnd(2),bf) dn = -7.5 do = 5 for i=1,15 do cd=i/(15) dp=ds-dn*du*cd+(rnd(2)-1) dq=dt-do*du*cd+(rnd(2)-1) circfill( dp, dq, (1-(cd))*du*2, bf ) end circfill(ds+1,dt-1,du+rnd(3)-1,z) a() bf=9+abs(sin(time()*2))*2 pal(10,bf) bf=8+abs(sin(time()*4))*2 pal(8,bf) sspr(0,32,128,32,0,54) pal(10,10) pal(8,8) if bb then print('press z/x',46,90,7) end end if b then u.vx *= 0.95 u.vy *= 0.95 be('collect pink power-ups|   to get angry and|smash all your enemies',19,44,1) be('collect #pink power-ups|   to get @angry and|smash all your !enemies',19,42,12) if bb then print('press z/x',46,90,7) end end if l then poke(0x5f80, 1) elseif f then poke(0x5f80, 3) else poke(0x5f80, 2) end end
__gfx__
000000000000000000777777776000000000000000000000000000000677780000000000d777200000477777777777a000c77777777777777750000000000000
0000000000000000733444555660000000000000000000000000000006888a0000000000d222300000555666888aaab000ccddd2223334445550000000000000
0000000000000007333444555660000000000000000000000000000006888a7000000007d222300000555666888aaab000ccddd2223334445550000000000000
0000000000000072333444555660000000000000000000000000000006888aa70000007dd222300000555666888aaab000ccddd2223334445550000000000000
000000000000002333444555666000000000000000000000000000000888aaab700007dd22233000005566611111111000cddd22233344455560000000000000
000000000000072333441111111000000000000000000000000000000888aaabb7007ddd22233000005566600000000000111111233341111110000000000000
000000000000022333410000000000000000000000000000000000000888aaabbb77cddd22233000005566600000000000000000233340000000000000000000
00000000000002333410000000000000000000000000000000000000088aaabbbcccddd222333000005666877777b00000000000333440000000000000000000
00000000000002333400000000000000000000000000000000000000088aaabbbcccddd222333000005666888aaab00000000000333440000000000000000000
00000000000002333400000000000000000000000000000000000000088aaabbbcccddd222333000005666888aaab00000000000333440000000000000000000
0000000000000333440000000000000000000000000000000000000008aaab1bcccddd212333400000666888aaabb00000000000334440000000000000000000
0000000000000333440000000000000000000000000000000000000008aaab01cccddd1023334000006668811111100000000000334440000000000000000000
0000000000000333447000000000000000000000000000000000000008aaab001ccdd10023334000006668800000000000000000334440000000000000000000
000000000000033444570000000000000000000000000000000000000aaabb0001dd100033344000006688800000000000000000344450000000000000000000
000000000000013444557777778000000000000000000000000000000aaabb000011000033344000006688800000000000000000344450000000000000000000
000000000000013444555666888000000000000000000000000000000aaabb00000000003334400000668887777777c000000000344450000000000000000000
00000000000000144555666888a000000000000000000000000000000aabbb000000000033444000006888aaabbbccc000000000444550000000000000000000
00000000000000014555666888a000000000000000000000000000000aabbb000000000033444000006888aaabbbccc000000000444550000000000000000000
00000000000000001155666888a000000000000000000000000000000aabbb000000000033444000006888aaabbbccc000000000444550000000000000000000
00000000000000000011111111100000000000000000000000000000011111000000000011111000001111111111111000000000111110000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000002aaaa000000000000000000000000000000000000
00000000000000000000000000000000000000000aaaaaa2000000000000000000000000000000000000000aaaaa000000000000000000000000000000000000
000000000000000000000000000000000000000aaaaaaaaa000000000000000000000000000000000000000aaaa2000000000000000000000000000000000000
00000000000000000000000000000000000000aa8aaa8aaa80000000000000000000000000000000000000aa8aa0000000000000000000000000000000000000
0000000000000000000000000000000000000aaaaaaaaaaaa0000000000000000000000000000000000000aaaa20000000000000000000000000000000000000
0000000000000000000000000000000000008a8aaa8aaa8aa000000000000000000000000000000000000a8aaa00000000000000000000000000000000000000
000000000000000000000000000000000002a8aaaa2aaaaa2000000000000000000000000000000000000aaaaa00000000000000000000000000000000000000
00000000000000000000000000000000000a8a8a80008a8a000a228a8000000022000000002a8a8a00008a8a8200000000000000000000000000000000000000
000000000000000000000000000000000028aaa80000aaa000a8aaa8a20002a8aaa200000aa8aaa82000aaa8a000000000000000000000000000000000000000
00000000000000000000000000000000008a8a8200000000028a8a8a80008a8a8a8a80008a8a8a8a00028a8a8002200000000000000000000000000000000000
0000000000000000000000000000000000a8a8a00000000008a8a8a80008a8a8a8a8a002a8a8a8200008a8a822a8a80000000000000000000000000000000000
00000000000000000000000000000000008a888000000000088a8820008a888a888a800a888a8000000a8a8a288a888000000000000000000000000000000000
0000000000000000000000000000000002a8a8200000000028a8a20002a8a8a8a8a8a008a8a8a8000008a8a8a8a8a8a000000000000000000000000000000000
0000000000000000000000000000000002888a20000000008a8880000a888a828a8880008a888a8000288a888a888a8000000000000000000000000000000000
0000000000000000000000000000000002a8a82000000000a8a8a00008a8a208a8a8a00008a8a8a200a8a8a8a8a8a8a000000000000000000000000000000000
00000000000000000000000000000000028888822888000288882000288820088888200000288888008888888088882000000000000000000000000000000000
000000000000000000000000000000000088a8a8a8880008a888000028a820a8a8a82028a8a8a8a20288a8a80088a82000000000000000000000000000000000
00000000000000000000000000000000008888888888800888880000288888888888228888888882088888820028888000000000000000000000000000000000
00000000000000000000000000000000002888888888000888820000088888a8888888a8888888a0088888800008888000000000000000000000000000000000
00000000000000000000000000000000000088888820000888800000008888820222288888888800008882000000882000000000000000000000000000000000
00000000000000000000000000000000000000000000000020000000000000000000008888880000000000000000000000000000000000000000000000000000
__sfx__
010400001e6721866214662116520e6520c6420a64207642066420563204632046320363203622036220262202622026220262200612006120061200612006120061200612006120061200612006120061500602
010200000047102471044610546107451024510c4710e471104611146113451184511a4711c4711d4611f461244512645128471294712b46130465324553444535435374251b4001d4001f4001b4001b4001f400
010300001b370273661b356273461b336273261b315273151b3050330302304023050130301304013050030300304003050030300304003050030300304003050030500303003040030500305003050030500300
010200001e3731836414365113530e3540c3450a34307344063450533304334043350333303324033250232302324023250232300314003150031300314003150031300314003150031500305003020030200302
010a00001843106415284002840028400284002840028400284002840028400284002840028400284002840028400284002840000405004050040500405004050040500405004050040500405004050040500405
010400002461130615246002460024600246002460024600006000060000600006000060000600006000060000600006000060000600006000060000600006000060000600006000060000600006000060000600