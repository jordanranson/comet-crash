pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
l=0 u=false f=true co={x=0,y=0} bg={ x=0, y=0, vx=0, vy=0 } v={ {13,12,6}, {8,9,10}, {5,6,7} } function m(i) return v[i][flr(rnd(3))+1],v[i][3] end function n(x,y) co.x=x co.y=y camera(x+bg.x,y+bg.y) end function w(amt) cw=1 if rnd()>.5 then cw=-1 end cz=1 if rnd()>.5 then cz=-1 end bg.x+=cw*amt bg.y+=cz*amt end function bh(num,x,y,vx,vy,cols,life,kind) if num==-1 and u then return end if num==-1 then num=1 end for i=1,num do k=cols[flr(rnd(#cols)+1)] cw=1 if rnd()>.5 then cw=-1 end cz=1 if rnd()>.5 then cz=-1 end add(b,{ x=x, y=y, vx=vx*rnd()*cw, vy=vy*rnd()*cz, col=k, cur=0, life=life, size=rnd(2), kind=kind }) end end function cp(dx,dy,r) if c then return end dx=abs(dx) dy=abs(dy) if dx>r or dy>r then return end dist=sqrt(dx*dx+dy*dy) return dist<=r end function cq() g=0 z=0 ba=0 d=0 c=false a=0 b={} o={ x=0, y=0, s=0, vx=0, vy=0 } bb={} bl={x=-99,y=0} p={} for i=1,128 do add(bb,{ x=rnd(128), y=rnd(128), z=flr(i/42)+1 }) end if not f then h() end end function h() bl={ x=o.x+rnd(512)-256, y=o.y+rnd(512)-256 } end function bm() g+=1 o.s=0 q=45 p={} for i=1,g+1 do add(p,{ x=o.x+rnd(512)-256, y=o.y+rnd(512)-256, vx=0, vy=0 }) end add(p,o) end function _init() cq() c=true a=100 end function _draw() cls(0) l+=1 if l==2 then if u then u=false else u=true end l=0 end bg.vx+=-bg.x*.4 bg.vy+=-bg.y*.4 bg.vx*=.85 bg.vy*=.85 bg.x+=bg.vx bg.y+=bg.vy if bg.vx>-.1 and bg.vx<.1 and bg.vy>-.1 and bg.vy<.1 then bg.vx=0 bg.vy=0 end for i,cn in pairs(bb) do cn.x-=o.vx/cn.z/2 cn.y-=o.vy/cn.z/2 cw=cn.x cz=cn.y if cn.x<0 then cn.x=127 end if cn.x>127 then cn.x=0 end if cn.y<0 then cn.y=127 end if cn.y>127 then cn.y=0 end srand(i) s={6,13,1} n(0,0) circ(cw,cz,0,s[cn.z]) end srand(time()) cw=.05 if c or f then if a>45 then if btnp(4) then f=false cq() bm() end end else if btn(0) then o.vx-=cw end if btn(1) then o.vx+=cw end if btn(2) then o.vy-=cw end if btn(3) then o.vy+=cw end if o.s>0 and d<1 then if btnp(4) or btnp(5) then w(3) bh(100,o.x,o.y,7,7,v[2],50) d=45 q=0 o.s=0 ca=atan2(o.vx,o.vy) cw=cos(ca)*5 cz=sin(ca)*5 if btnp(5) then cw*=-1 cz*=-1 o.vx*=-1 o.vy*=-1 end o.vx+=cw o.vy+=cz end end end n(o.x-64,o.y-64) circ(bl.x,bl.y,6+rnd(18),13+rnd(3)) bh(-1,bl.x,bl.y,.7,.7,{1,2,13,14},50) if u then circfill(bl.x,bl.y,21+rnd(6),rnd(3)) end cu=o.x-bl.x cv=o.y-bl.y if cp(cu,cv,23) then if o.s<1 then h() w(2) bh(50,bl.x,bl.y,3,3,{12,15,13,14},30) bh(50,o.x,o.y,3,3,{12,15,13,14},30) o.s=1 q=0 end end for k,e in pairs(b) do e.vx*=.99 e.vy*=.99 e.x+=e.vx e.y+=e.vy e.cur+=1 if e.cur>e.life then del(b,e) end circ(e.x,e.y,e.size,e.col) end for i,bc in pairs(p) do bd=1 if o.s>0 and d<1 then bd=2 end if d>0 then bd=2 end be,t=m(bd) if q>0 and u and d<1 then be=0 end if bc~=o then be,t=m(3) cs=12 if not c then cu=o.x-bc.x cv=o.y-bc.y bc.vx+=cu*.001 bc.vy+=cv*.001 end ca=0 if o.s>0 then ca=2 end if d>0 then ca=21 end if cp(cu,cv,7+ca) then if (q<1 and o.s>0) or d>0 then del(p,bc) w(3) bh(50,o.x,o.y,3,3,v[2],30) if d<1 then q=60 z+=10 o.s=0 else z+=30 end elseif (not c) and q<1 then c=true a=0 w(7) bh(90,o.x,o.y,3,3,v[1],200) bh(10,bc.x,bc.y,3,3,v[3],200) end end ca=1 else if q>0 then q-=1 end ca=1+(o.s/4) end bc.vx*=.99 bc.vy*=.99 bc.x+=bc.vx bc.y+=bc.vy if bc~=o then for j,bf in pairs(p) do if bf~=bc and bf~=o then cu=bf.x-bc.x cv=bf.y-bc.y if cp(cu,cv,15) then bc.vx-=cu*.02 bc.vy-=cv*.02 end end end end if bc==o and d>0 then if l%2==0 then circfill(bc.x,bc.y,16+rnd(6),8+rnd(3)) circ(bc.x,bc.y,6+rnd(18),8+rnd(3)) end d-=1 end if (bc==o and not c) or bc~=o then circfill(bc.x,bc.y,ca+1+rnd(2),be) if abs(bc.vx)>3.5 or abs(bc.vy)>3.5 then bh(-1,bc.x,bc.y,1,1,{be},10) end if bc==o and o.s>0 then bh(-1,bc.x,bc.y,1,1,{be},10) end for i=1,12 do ct=i/(12) cw=bc.x-bc.vx*3*ct+(rnd(2)-1) cz=bc.y-bc.vy*3*ct+(rnd(2)-1) ct=ca-ct circfill(cw,cz,ct*3,be) end circfill(bc.x,bc.y,ca+rnd(2),t) end end if #p==1 then bm() end n(0,0) if not c then for i,bc in pairs(p) do if i<#p then cu=o.x-bc.x cv=o.y-bc.y if abs(cu)>64 or abs(cv)>64 then be=8 if abs(cu)<96 and abs(cv)<96 and u then be=10 end ca=atan2(cu,cv) cw=-cos(ca)*50 cz=-sin(ca)*50 cu=-cos(ca)*60 cv=-sin(ca)*60 line(cw+64,cz+64,cu+64,cv+64,be) end end end cu=o.x-bl.x cv=o.y-bl.y if abs(cu)>64 or abs(cv)>64 then be=14 if abs(cu)<96 and abs(cv)<96 and u then be=7 end ca=atan2(cu,cv) cw=-cos(ca)*50 cz=-sin(ca)*50 cu=-cos(ca)*60 cv=-sin(ca)*60 line(cw+64,cz+64,cu+64,cv+64,be) end end if not f then print('wave  '..g,3,3,12) print('score '..z,3,10,12) end if a<100 then a+=1 end if c and (a>45 or f) then print('press z/x',44,61,7) end end